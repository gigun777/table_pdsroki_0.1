<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>TransferUI Demo</title>
  <link rel="stylesheet" href="./transfer_modals.css"/>
</head>
<body style="font-family:system-ui; padding:20px;">
  <h2>TransferUI Demo</h2>
  <p>–¶–µ –¥–µ–º–æ –ø–æ–∫–∞–∑—É—î, —è–∫ –≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏ –º–æ–¥–∞–ª–∫–∏.</p>

  <button id="openSettings" style="padding:10px 12px;">–í—ñ–¥–∫—Ä–∏—Ç–∏ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚Üí –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è</button>
  <button id="openTransfer" style="padding:10px 12px; margin-left:8px;">–í—ñ–¥–∫—Ä–∏—Ç–∏ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ (–¥–ª—è –≤–∏–¥—ñ–ª–µ–Ω–æ–≥–æ —Ä—è–¥–∫–∞)</button>

<!-- TransferUI modals markup: include once -->
<div id="dvTransferSettingsOverlay" class="dv-modal-overlay" aria-hidden="true">
  <div class="dv-modal" role="dialog" aria-modal="true" aria-labelledby="dvTransferSettingsTitle">
    <div class="dv-modal-header">
      <div>
        <div class="dv-modal-title" id="dvTransferSettingsTitle">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚Üí –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è</div>
        <div class="dv-modal-subtitle" id="dvTransferSettingsSubtitle">–®–∞–±–ª–æ–Ω–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è (1 –º–∞—Ä—à—Ä—É—Ç = 1 —Ü—ñ–ª—å–æ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞)</div>
      </div>
      <button class="dv-modal-close" data-dv-close="settings" title="–ó–∞–∫—Ä–∏—Ç–∏">‚úï</button>
    </div>
    <div class="dv-modal-body">
      <div class="dv-settings-grid">
        <div class="dv-panel">
          <div class="dv-panel-h">–®–∞–±–ª–æ–Ω–∏</div>
          <div class="dv-panel-b">
            <div id="dvTplList" class="dv-list"></div>
            <div class="dv-row" style="margin-top:12px;">
              <button id="dvTplAdd" class="dv-btn">+ –î–æ–¥–∞—Ç–∏ —à–∞–±–ª–æ–Ω</button>
              <button id="dvTplDel" class="dv-btn dv-btn-danger">üóë –í–∏–¥–∞–ª–∏—Ç–∏</button>
            </div>
          </div>
        </div>
        <div class="dv-panel">
          <div class="dv-panel-h">–†–µ–¥–∞–∫—Ç–æ—Ä —à–∞–±–ª–æ–Ω—É</div>
          <div class="dv-panel-b">
            <div class="dv-row" style="justify-content:space-between; gap:14px;">
              <div class="dv-col" style="flex:1; min-width:260px;">
                <div class="dv-label">–ù–∞–∑–≤–∞</div>
                <input id="dvTplName" class="dv-input" placeholder="–ù–∞–ø—Ä.: –í—Ö—ñ–¥–Ω—ñ ‚Üí –ê—Ä—Ö—ñ–≤" />
              </div>
              <div class="dv-col" style="flex:1; min-width:260px;">
                <div class="dv-label">–ó –ª–∏—Å—Ç–∞</div>
                <select id="dvFromSheet" class="dv-select"></select>
              </div>
              <div class="dv-col" style="min-width:40px; align-items:center; justify-content:flex-end;">
                <div class="dv-label" style="visibility:hidden;">‚Üí</div>
                <div style="height:34px; display:flex; align-items:center; font-weight:900;">‚Üí</div>
              </div>
              <div class="dv-col" style="flex:1; min-width:260px;">
                <div class="dv-label">–î–æ –ª–∏—Å—Ç–∞</div>
                <select id="dvToSheet" class="dv-select"></select>
              </div>
            </div>
            <div class="dv-hint" id="dvTplHint"></div>
            <div style="margin-top:10px; display:flex; align-items:center; justify-content:space-between;">
              <div class="dv-label" style="font-size:13px; color:#111;">–ú–∞—Ä—à—Ä—É—Ç–∏</div>
              <button id="dvRouteAdd" class="dv-btn">+ –î–æ–¥–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç</button>
            </div>
            <div id="dvRoutes"></div>
          </div>
        </div>
      </div>
      <div class="dv-alert" id="dvSettingsMsg" style="display:none;"></div>
    </div>
    <div class="dv-modal-footer">
      <button class="dv-btn" data-dv-close="settings">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      <button id="dvSettingsReload" class="dv-btn">‚Üª –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
      <button id="dvSettingsSave" class="dv-btn dv-btn-primary">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
    </div>
  </div>
</div>

<div id="dvTransferExecOverlay" class="dv-modal-overlay" aria-hidden="true">
  <div class="dv-modal dv-sm" role="dialog" aria-modal="true" aria-labelledby="dvTransferExecTitle">
    <div class="dv-modal-header">
      <div>
        <div class="dv-modal-title" id="dvTransferExecTitle">–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É</div>
        <div class="dv-modal-subtitle" id="dvTransferExecSubtitle"></div>
      </div>
      <button class="dv-modal-close" data-dv-close="exec" title="–ó–∞–∫—Ä–∏—Ç–∏">‚úï</button>
    </div>
    <div class="dv-modal-body">
      <div class="dv-row" style="justify-content:space-between;">
        <div class="dv-col" style="flex:1; min-width:260px;">
          <div class="dv-label">–®–∞–±–ª–æ–Ω</div>
          <select id="dvExecTemplate" class="dv-select"></select>
        </div>
      </div>
      <div class="dv-alert" id="dvExecInfo" style="margin-top:12px;"></div>
      <div style="margin-top:10px;">
        <div class="dv-label" style="font-size:13px; color:#111;">–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥</div>
        <table class="dv-preview-table" style="margin-top:8px;">
          <thead>
            <tr>
              <th style="width:34%;">–ó–≤—ñ–¥–∫–∏ (–¥–∂–µ—Ä–µ–ª–∞)</th>
              <th style="width:16%;">–û–ø–µ—Ä–∞—Ü—ñ—è</th>
              <th style="width:22%;">–ö—É–¥–∏ (—Ü—ñ–ª—å)</th>
              <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
            </tr>
          </thead>
          <tbody id="dvExecPreview"></tbody>
        </table>
        <div class="dv-hint">–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –∫–æ–ª–æ–Ω–æ–∫ —Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–µ–¥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º.</div>
      </div>
      <div style="margin-top:12px; display:flex; flex-direction:column; gap:8px;">
        <label class="dv-checkbox"><input id="dvExecGoToTarget" type="checkbox" checked /> –ü—ñ—Å–ª—è –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –ª–∏—Å—Ç–∞-–ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</label>
        <label class="dv-checkbox"><input id="dvExecCloseOnSuccess" type="checkbox" checked /> –ó–∞–∫—Ä–∏—Ç–∏ –≤—ñ–∫–Ω–æ –ø—ñ—Å–ª—è —É—Å–ø—ñ—Ö—É</label>
      </div>
      <div class="dv-alert" id="dvExecMsg" style="display:none;"></div>
    </div>
    <div class="dv-modal-footer">
      <button class="dv-btn" data-dv-close="exec">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      <button id="dvExecApply" class="dv-btn dv-btn-primary">–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏</button>
    </div>
  </div>
</div>


  <script src="./transfer_modals.js"></script>
  <script>
    const sheets = [
      { key:"inbox", name:"–í—Ö—ñ–¥–Ω—ñ", columns:[{id:"c1",name:"–î–∞—Ç–∞"},{id:"c2",name:"–ü–Ü–ë"},{id:"c3",name:"–¢–µ–º–∞"},{id:"c4",name:"–°—É–º–∞"}] },
      { key:"archive", name:"–ê—Ä—Ö—ñ–≤", columns:[{id:"a1",name:"–î–∞—Ç–∞"},{id:"a2",name:"–ó–∞–≥–æ–ª–æ–≤–æ–∫"},{id:"a3",name:"–ö–æ–º–µ–Ω—Ç–∞—Ä"},{id:"a4",name:"–†–∞–∑–æ–º"}] }
    ];

    let templates = [{
      id:"tpl1",
      name:"–í—Ö—ñ–¥–Ω—ñ ‚Üí –ê—Ä—Ö—ñ–≤ (–ø—Ä–∏–∫–ª–∞–¥)",
      fromSheetKey:"inbox",
      toSheetKey:"archive",
      routes:[
        {sources:[0], op:"concat", delimiter:" ", targetCol:0},
        {sources:[1,2], op:"concat", delimiter:" ‚Äî ", targetCol:1},
        {sources:[2], op:"seq", delimiter:"", targetCol:2},
        {sources:[3], op:"sum", delimiter:"", targetCol:3}
      ]
    }];

    const sourceRow = ["2026-02-19","–ü–µ—Ç—Ä–µ–Ω–∫–æ –Ü–≤–∞–Ω","–õ–∏—Å—Ç —â–æ–¥–æ –¥–æ–≥–æ–≤–æ—Ä—É","123,45"];

    document.getElementById("openSettings").onclick = () => {
      TransferUI.openSettings({
        sheets,
        templates,
        onSave: (newTemplates) => { templates = newTemplates; console.log("saved", templates); }
      });
    };

    document.getElementById("openTransfer").onclick = () => {
      TransferUI.openTransfer({
        sheets,
        templates,
        sourceSheetKey:"inbox",
        sourceRow,
        onApply: ({template, targetRow, actions}) => {
          console.log("APPLY", {template, targetRow, actions});
          alert("targetRow —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–æ. –î–∏–≤–∏—Å—å console.");
        }
      });
    };
  </script>
</body>
</html>
